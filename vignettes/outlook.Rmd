---
title: "Outlook email"
author: Hong Ooi
output: rmarkdown::html_vignette
vignette: >
    %\VignetteIndexEntry{Outlook email}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{utf8}
---

This vignette describes how to use Microsoft365R to interact with [Outlook](https://www.microsoft.com/en-au/microsoft-365/outlook/email-and-calendar-software-microsoft-outlook) for managing and sending email. See the "Authenticating to Microsoft 365" vignette for more details on authentication if required.

## Outlook client

To access your Outlook inbox, use either the `get_personal_outlook()` or `get_business_outlook()` function. The first one is for your personal account, and the second is for your work & school account. They return objects of R6 class `ms_outlook`.

```r
outl <- get_personal_outlook()
outlb <- get_business_outlook()
```

The `ms_outlook` object has methods for creating new emails, listing emails in your inbox, and working with folders.

```r
# list the most recent emails in your inbox
outl$list_emails()

# create a new email (will be saved in the drafts folder)
outl$create_email()

# list your mail folders
outl$list_folders()

# get some common folders
inbox <- outl$get_inbox()
drafts <- outl$get_drafts()
sent <- outl$get_sent_items()

# get a specific folder by name
folder <- outl$get_folder("myfolder")
```

## Writing emails

To write a new email, call the `create_email()` method as noted above. You can create a blank email which you then edit, or supply the details in the method call itself. The message will be saved in the drafts folder.

```r
# create a draft email
outl$create_email("Hello from R", content_type="text", subject="Hello",
    to="bob@example.com", cc="charlie@example.com")

# or: create a blank draft, then add details
eml <- outl$create_email()
eml$set_body("Hello from R", content_type="text")
eml$set_subject("Hello")
eml$set_recipients(to="bob@example.com", cc="charlie@example.com")

# or: use method chaining to achieve the same thing
outl$
    create_email()$
    set_body("Hello from R", content_type="text")$
    set_subject("Hello")$
    set_recipients(to="bob@example.com", cc="charlie@example.com")
```

In the example above, the email has a plain text message body. You can specify that the email should be in HTML format by setting the `content_type` argument to "html", and then providing a suitable message body.

```r
outl$create_email("<h2>Hello world!</h2>", content_type="html")
```

However, Microsoft365R also supports using the blastula and emayili packages to write nicely-formatted HTML emails. In particular, blastula lets you compose your email in Markdown, which is often easier than writing raw HTML.

```r
bl_body <- "## Hello!

This is an email message that was generated by the blastula package.

We can use **Markdown** formatting with the `md()` function.

Cheers,

The blastula team"

library(blastula)
bl_em <- compose_email(
    body=md(bl_body),
    footer=md("sent via Microsoft365R")
)
em <- outl$create_email(bl_em, subject="Hello from R", to="bob@example.com")
```


